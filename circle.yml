machine:
  environment:
    GOPATH: "/home/ubuntu/.go_workspace"
    CGO_ENABLED: "0"

dependencies:
  pre:
    - go get -d github.com/mitchellh/packer

  override:
    - rm -rf $GOPATH/src/github.com/MSOpenTech/packer-azure && ln -s ~/packer-azure/ $GOPATH/src/github.com/MSOpenTech/packer-azure
    - cd $GOPATH/src/github.com/MSOpenTech/packer-azure && go get ./...

  post:
    - tar -czvf $CIRCLE_ARTIFACTS/packer.tgz -C  $GOPATH/bin $(find $GOPATH/bin -name packer\* -printf '%P ')

test:
  override:
    - /bin/true
